<html>

<head>
  <link type="text/css" rel="stylesheet" href="stylesheet.css" />

  <div class="carcImage">

    <title>Carcasonne</title>
  </div>

  <script src="carcassonne.js"></script>
  <script type="text/javascript">
    var numRotations = 0;
    var tileInPlay = "";
    var playerNames = ["Hayley", "Grant"];
    var playerScores = [0, 0];
    var tilesUsed = 0;
    var meeplesUsed = 0;
    var tilesRemaining = -1;
    var numCols = 4;
    var numRows = 5;
    
    var LEFT_ARROW = 37;
    var UP_ARROW = 38;
    var RIGHT_ARROW = 39;
    var DOWN_ARROW = 40;

    function Init() {
      getInitialImageList();
      getMeepleImageList();

      var meeplePerPlayer = 7;
      for (var player = 1; player <= playerNames.length; player++) {
        for (var meepleCount = 1; meepleCount <= meeplePerPlayer; meepleCount++) {
          addMeeple(player, meepleCount);
        }
      }

      tilesRemaining = tileImages.length;

      document.getElementById('player1Name').value = playerNames[0];
      document.getElementById('player1Score').value = playerScores[0];
      document.getElementById('player2Name').value = playerNames[1];
      document.getElementById('player2Score').value = playerScores[1];

      genDivs();
    }



    function addMeeple(playerNum, meepleNum) {
      var x = document.getElementById('meepleDiv');
      var input1 = document.createElement("img");
      var meepleImage = selectMeepleImage(playerNum - 1);
      var meepleHeightStart = 0;
      var meepleWidthSpacing = 50;
      var meepleHeightSpacing = 35;
      input1.src = meepleImage;
      input1.width = "25";
      input1.height = "25";
      input1.id = ("name", "m" + meeplesUsed);
      input1.setAttribute("name", "m" + meeplesUsed);
      //input1.setAttribute("className","meeple");
      input1.setAttribute('z-index', '1');
      x.appendChild(input1);
      var imgEle = document.getElementById(("name", "m" + meeplesUsed));
      imgEle.addEventListener('dragstart', function(ev) {
        drag(ev)
      }, false);
      imgEle.className = "meeple";
      var imgStyle = imgEle.getAttribute("style");
      imgEle.setAttribute("style", "left:" + meepleWidthSpacing * meepleNum + "; top:" + (meepleHeightStart + meepleHeightSpacing * playerNum));

      meeplesUsed++;
    }


    function addTile() {
      var tileButton = document.getElementById('DrawTile');
      tileButton.disabled=true;
      
      var tileDiv = document.getElementById('drawnTileDiv');

      var input1 = document.createElement("img");
      var tileImage = selectTileImage();
      input1.src = tileImage;
      input1.width = "75";
      input1.height = "75";
      input1.className = "tile";
      input1.id = ("name", "i" + tilesUsed);
      input1.setAttribute("name", "i" + tilesUsed);
      input1.setAttribute('z-index', '1');
      tileDiv.appendChild(input1);
      var imgEle = document.getElementById(("name", "i" + tilesUsed));
      imgEle.addEventListener('dragstart', function(ev) {
        drag(ev)
      }, false);
      tileInPlay = imgEle;
      tilesUsed++;

      tilesRemaining--;
      document.getElementById('tilesRemaining').value = tilesRemaining;

    }

    function allowDrop(ev) {
      ev.preventDefault();
    }

    var dragElement = null;

    function dragMeeple(event) {
      var style = window.getComputedStyle(dragElement, null);
      event.dataTransfer.setData("text/plain", (parseInt(style.getPropertyValue("left"), 10) - event.clientX) + ',' + (parseInt(style.getPropertyValue("top"), 10) - event.clientY));
    }

    function dragTile(ev) {
      ev.dataTransfer.setData("text", ev.target.id);
    }

    function drag(ev) {
      dragElement = document.getElementById((event.target.id));
      var dragKey = ev.target.className;
      if (dragKey == "meeple") {
        dragMeeple(ev);
      } else {
        dragTile(ev);
      }
    }

    function drop(ev) {
      var dragKey = dragElement.className;
      if (dragKey == "meeple") {
        dropMeeple(ev);
      } else {
        dropTile(ev);
      }
    }

    function dropTile(ev) {
      ev.preventDefault();
      var data = ev.dataTransfer.getData("text");

      if (event.target.nodeName !== "IMG") {
        ev.target.appendChild(document.getElementById(data));
      } else {
        var parentDiv = ev.target.parentNode;
        parentDiv.appendChild(document.getElementById(data));
      }

      var tileButton = document.getElementById('DrawTile');
      tileButton.disabled=false;

    }

    function dropMeeple(ev) {
      ev.preventDefault();
      var offset = ev.dataTransfer.getData("text/plain").split(',');
      dragElement.style.left = (ev.clientX + parseInt(offset[0], 10)) + 'px';
      dragElement.style.top = (ev.clientY + parseInt(offset[1], 10)) + 'px';
      ev.target.appendChild(document.dragElement);
    }

    function genDivs() {
      var boardGrid = document.getElementById('boardDiv');
      for (var colIndex = 0; colIndex < numRows; colIndex++) {
        var row = document.createElement("div");
        row.className = "row";
        row.id = ("name", "row" + colIndex);
        for (var rowIndex = 0; rowIndex < numCols; rowIndex++) {
          addGridCell(colIndex, rowIndex, row)
        }
        boardGrid.appendChild(row);
      }
      allowDropsInDivs(numCols);
    }

    function addGridCell(colIndex, rowIndex, row) {
      var cell = document.createElement("div");
      cell.className = "gridsquare";
      var cellNumber = (colIndex * numCols) + rowIndex;
      cell.innerText = cellNumber;
      cell.id = ("name", "cell" + cellNumber);
      row.appendChild(cell);
    }

    function addRowOfCells() {
      var boardGrid = document.getElementById('boardDiv');
      var row = document.createElement("div");
      row.className = "row";
      row.id = ("name", "row" + numRows);
      for (var rowIndex = 0; rowIndex < numCols; rowIndex++) {
        addGridCell(numRows, rowIndex, row)
      }
      boardGrid.appendChild(row);
      allowDropsInDivs(numCols);
      numRows = numRows + 1;
    }

    function addColumnOfCells() {
      var boardGrid = document.getElementById('boardDiv');
      for (var colIndex = 0; colIndex < numRows; colIndex++) {
        var row = document.getElementById(("name", "row" + colIndex));
        addGridCell(numRows, colIndex, row)
      }
      allowDropsInDivs(numCols);
      numCols = numCols + 1;
    }
    
    
     function addGridCellFront(colIndex, rowIndex, row) {
      var cell = document.createElement("div");
      cell.className = "gridsquare";
      var cellNumber = (colIndex * numCols) + rowIndex;
      cell.innerText = cellNumber;
      cell.id = ("name", "cell" + cellNumber);
      row.prependChild(cell);
    }

    function addRowOfCellsTop() {
	alert("enter");
      var boardGrid = document.getElementById('boardDiv');
      var row = document.createElement("div");
      row.className = "row";
      row.id = ("name", "row" + numRows);
      for (var rowIndex = 0; rowIndex < numCols; rowIndex++) {
        addGridCellFront(numRows, rowIndex, row)
      }
      boardGrid.prependChild(row);
      allowDropsInDivs(numCols);
      numRows = numRows + 1;
    }

    function addColumnOfCellsLeft() {
      var boardGrid = document.getElementById('boardDiv');
      for (var colIndex = 0; colIndex < numRows; colIndex++) {
        var row = document.getElementById(("name", "row" + colIndex));
        addGridCellFront(numRows, colIndex, row)
      }
      allowDropsInDivs(numCols);
      numCols = numCols + 1;
    }
    
    

    function allowDropsInDivs(numCols) {
      var totalCols = numCols * numCols;
      for (var col = 1; col <= (numCols * numCols); col++) {
        var cellEle = document.getElementById(("name", "cell" + col))
        cellEle.addEventListener("drop", function(ev) {
          drop(ev)
        }, false);
        cellEle.addEventListener('dragover', function(ev) {
          allowDrop(ev)
        }, false);
      }
    }

    function rotateImage() {
      numRotations++;
      rotateImageCore()
    }
    
    function rotateImageCore() {
      var imageToRotate = tileInPlay;
      imageToRotate.setAttribute("style", "transform:rotate(" + (90 * numRotations) + "deg)");
    }

    function addPoints(playerNum) {
      var newPoints = parseInt(document.getElementById(("player" + playerNum + "NewPoints")).value);
      var curPoints = parseInt(document.getElementById(("player" + playerNum + "Score")).value);
      document.getElementById(("player" + playerNum + "Score")).value = curPoints + newPoints;

    }

    document.onkeydown = function(e) {
      switch (e.keyCode) {
        case LEFT_ARROW:
          {
            numRotations--;
            rotateImageCore();
            break;
          }
        case UP_ARROW:
          {
            numRotations--;
            rotateImageCore();
            break;
          }
        case RIGHT_ARROW:
          {
            numRotations++;
            rotateImageCore();
            break;
          }
        case DOWN_ARROW:
          {
            numRotations++;
            rotateImageCore();
            break;
          }
      }
    };
    
  </script>
</head>

<body onload="Init()">
  <div id="projectInfo">
    <h1>Carcassonne </h1>
  </div>

  <nav>
    <!-- <ul>
        <li><a href="gameStart.html">Game Start</a></li>
      </ul> -->
  </nav>

  <div id="PlayerInfo">
    <br /> Player 1:
    <input type="string" id="player1Name" value="" /> Player 1 Score:
    <input type="integer" id="player1Score" value="" readonly/> Add Points:
    <input type="integer" id="player1NewPoints" value="" />
    <input type="button" onclick="addPoints(1)" value="Add Points">
    <br /> Player 2:
    <input type="string" id="player2Name" value="" /> Player 2 Score:
    <input type="integer" id="player2Score" value="" readonly/> Add Points:
    <input type="integer" id="player2NewPoints" value="" />
    <input type="button" onclick="addPoints(2)" value="Add Points">
    <br />
    <br />
    <input type="button" onclick="addRowOfCells()" value="Add Row">
    <input type="button" onclick="addColumnOfCells()" value="Add Column">
        <input type="button" onclick="addRowOfCellsTop()" value="Add Top Row">
    <input type="button" onclick="addColumnOfCellsLeft()" value="Add Left Column">
    <div />

    <div id="drawnTileDiv">
      Tiles Remaining:
      <input type="string" id="tilesRemaining" value="" readonly/>
      <div />

      <input type="button" id="DrawTile" value="Draw Tile" onclick="addTile()" />
      <input type="button" onclick="rotateImage()" value="Rotate Tile">


      <!--     <input type="button" onclick="genDivs(6)" value="Add grid"> -->



      <div id="meepleDiv" ondrop="drop(event)" ondragover="allowDrop(event)">
        <div />


        <div id="outerBoard">
          <div id="boardDiv">

          </div>
        </div>



</body>

</html>
